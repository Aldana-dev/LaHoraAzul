{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/modal.css') }}">
{% endblock %}

<div
  class="modal fade"
  id="modalCompra"
  tabindex="-1"
  aria-labelledby="modalCompraLabel"
  aria-hidden="true"
  role="dialog"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form
        id="form-datos-usuario"
        method="POST"
        action="{{ url_for('main.confirmar_pedido') }}"
        novalidate
      >
        <div class="modal-header">
          <h5 class="modal-title" id="modalCompraLabel">Proceso de compra</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Cerrar"
          ></button>
        </div>

        <div class="modal-body">
          <!-- Paso 1: Datos de envío -->
          <fieldset class="paso" id="paso-1">
            <!-- Nombre y Apellido -->
            <div class="row">
              <div class="col mb-3">
                <label for="nombre" class="form-label">Nombre</label>
                <input
                  type="text"
                  class="form-control"
                  id="nombre"
                  name="nombre"
                  autocomplete="given-name"
                  required
                />
              </div>
              <div class="col mb-3">
                <label for="apellido" class="form-label">Apellido</label>
                <input
                  type="text"
                  class="form-control"
                  id="apellido"
                  name="apellido"
                  autocomplete="family-name"
                  required
                />
              </div>
            </div>

            <!-- Dirección -->
            <div class="mb-3">
              <label for="direccion" class="form-label">Dirección</label>
              <input
                type="text"
                class="form-control"
                id="direccion"
                name="direccion"
                autocomplete="address-line1"
                placeholder="Calle y número"
              />
            </div>
            <div class="mb-3">
              <label for="referencias" class="form-label"
                >Piso / Departamento / Referencias</label
              >
              <input
                type="text"
                class="form-control"
                id="referencias"
                name="referencias"
                autocomplete="address-line2"
              />
            </div>

            <!-- Localidad -->
            <fieldset class="row">
              <div class="col mb-3">
                <label for="provincia" class="form-label">Provincia</label>
                <input
                  type="text"
                  class="form-control"
                  id="provincia"
                  name="provincia"
                  autocomplete="address-level1"
                  required
                />
              </div>
              <div class="col mb-3">
                <label for="localidad" class="form-label">Localidad</label>
                <input
                  type="text"
                  class="form-control"
                  id="localidad"
                  name="localidad"
                  autocomplete="address-level2"
                  required
                />
              </div>
              <div class="col mb-3">
                <label for="ciudad" class="form-label">Ciudad</label>
                <input
                  type="text"
                  class="form-control"
                  id="ciudad"
                  name="ciudad"
                  required
                />
              </div>
            </fieldset>

            <!-- CP -->
            <div class="mb-3">
              <label for="cp_usuario" class="form-label">Código Postal</label>
              <input
                type="text"
                class="form-control"
                id="cp_usuario"
                name="cp_usuario"
                inputmode="numeric"
                pattern="[0-9]{4,8}"
                title="Ingrese un código postal válido (4 a 8 dígitos)"
                autocomplete="postal-code"
                required
              />
              <small id="ayuda-cp" class="form-text text-muted">
                Ejemplo: 8300
              </small>
            </div>

            <fieldset class="mb-3">
              <legend id="form-label">Seleccionar tipo de envío</legend>
              <div id="modal-tarjetas-envio">
                <!-- Retiro en local -->
                <label
                  class="tarjeta-envio-modal"
                  data-tipo="local"
                  data-precio="0"
                >
                  <input
                    type="radio"
                    name="tipo_envio"
                    value="local"
                    required
                    hidden
                  />
                  <strong>Retiro en el local</strong>
                  <span class="precio-opcion-modal">$0.00</span>
                  <small class="texto-envio">Disponible inmediatamente</small>
                </label>

                <!-- Envío a domicilio -->
                <label class="tarjeta-envio-modal" data-tipo="domicilio">
                  <input
                    type="radio"
                    name="tipo_envio"
                    value="domicilio"
                    hidden
                  />
                  <strong>Envío a domicilio</strong>
                  <span class="precio-opcion-modal" id="precio-domicilio-modal"
                    >--</span
                  >
                  <small class="texto-envio" id="dias-domicilio"></small>
                </label>

                <!-- Retiro en sucursal -->
                <label class="tarjeta-envio-modal" data-tipo="sucursal">
                  <input
                    type="radio"
                    name="tipo_envio"
                    value="sucursal"
                    hidden
                  />
                  <strong>Retiro en sucursal</strong>
                  <span class="precio-opcion-modal" id="precio-sucursal-modal"
                    >--</span
                  >
                  <small class="texto-envio" id="dias-sucursal"></small>
                </label>
              </div>
            </fieldset>

            <!-- Selector de sucursal -->
            <div class="mb-3 d-none" id="campo-sucursal">
              <label for="selector-sucursal" class="form-label"
                >Seleccionar sucursal</label
              >
              <select id="selector-sucursal" class="form-control"></select>
              <small
                id="horarios-sucursal"
                class="form-text text-muted"
              ></small>
            </div>

            <!-- Contacto -->
            <div class="mb-3">
              <label for="email" class="form-label">Correo electrónico</label>
              <input
                type="email"
                class="form-control"
                id="email"
                name="email"
                autocomplete="email"
                required
              />
            </div>
            <div class="mb-3">
              <label for="telefono" class="form-label">Teléfono</label>
              <input
                type="tel"
                class="form-control"
                id="telefono"
                name="telefono"
                inputmode="tel"
                pattern="[0-9+ ]{7,15}"
                autocomplete="tel"
                required
              />
              <small class="form-text text-muted"> Ej: +54 294 1234567 </small>
            </div>

            <!-- Mensaje extra -->
            <div class="mb-3">
              <label for="mensaje" class="form-label"
                >Mensaje extra (opcional)</label
              >
              <textarea
                class="form-control"
                id="mensaje"
                name="mensaje"
                rows="3"
                placeholder="Ej: Entregar después de las 18hs, dejar en portería..."
              ></textarea>
            </div>
          </fieldset>

          <!-- Paso 2: Datos de pago -->
          <fieldset class="paso d-none" id="paso-2">
            <div class="mb-3">
              <label for="metodo_pago" class="form-label">Método de pago</label>
              <select
                id="metodo_pago"
                name="metodo_pago"
                class="form-control"
                required
              >
                <option value="">Seleccione...</option>
                <option value="tarjeta">Tarjeta de crédito/débito</option>
                <option value="transferencia">Transferencia bancaria</option>
                <option value="mercadopago">MercadoPago</option>
              </select>
            </div>

            <!-- Campos de tarjeta -->
            <div id="pago-tarjeta" class="d-none">
              <div class="mb-3">
                <label for="numero_tarjeta" class="form-label"
                  >Número de tarjeta</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="numero_tarjeta"
                  data-decidir="card_number"
                  inputmode="numeric"
                  pattern="[0-9]{13,19}"
                  placeholder="#### #### #### ####"
                />
              </div>
              <div class="row">
                <div class="col">
                  <label for="vencimiento" class="form-label"
                    >Vencimiento</label
                  >
                  <div class="d-flex gap-2">
                    <input
                      type="text"
                      class="form-control"
                      id="mes_vencimiento"
                      placeholder="MM"
                      maxlength="2"
                      inputmode="numeric"
                      data-decidir="card_expiration_month"
                    />
                    <input
                      type="text"
                      class="form-control"
                      id="anio_vencimiento"
                      placeholder="AA"
                      maxlength="2"
                      inputmode="numeric"
                      data-decidir="card_expiration_year"
                    />
                  </div>
                </div>
                <div class="col">
                  <label for="cvv" class="form-label">CVV</label>
                  <input
                    type="text"
                    class="form-control"
                    id="cvv"
                    maxlength="4"
                    pattern="[0-9]{3,4}"
                    inputmode="numeric"
                    data-decidir="security_code"
                  />
                </div>
              </div>
              <div class="mb-3">
                <label for="titular" class="form-label"
                  >Titular de la tarjeta</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="titular"
                  data-decidir="card_holder_name"
                  autocomplete="cc-name"
                />
              </div>
              <div class="mb-3">
                <label for="dni" class="form-label">Documento</label>
                <input
                  type="text"
                  class="form-control"
                  id="dni"
                  pattern="[0-9]{7,10}"
                  inputmode="numeric"
                  data-decidir="card_holder_doc_number"
                />
              </div>
            </div>
          </fieldset>

          <!-- Paso 3: Confirmación -->
          <fieldset class="paso d-none" id="paso-3">
            <legend>Confirmación de compra</legend>
            <p>Revisa que tus datos sean correctos antes de confirmar:</p>
            <ul id="resumen-compra"></ul>

            <!-- Términos -->
            <div class="mb-3 form-check">
              <input
                type="checkbox"
                class="form-check-input"
                id="acepto"
                required
              />
              <label class="form-check-label" for="acepto"
                >Acepto los términos y condiciones</label
              >
            </div>
          </fieldset>
        </div>

        <!-- Footer con navegación -->
        <div class="modal-footer">
          <button type="button" class="btn boton" id="btn-anterior" disabled>
            Anterior
          </button>
          <button type="button" class="btn boton" id="btn-siguiente">
            Siguiente
          </button>
          <button type="submit" class="btn boton" id="btn-confirmar">
            Confirmar compra
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
