{% extends "base.html" %} {% block title %}Carrito - La Hora Azul{% endblock %}
{% block extra_css %}

<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/carrito.css') }}"
/>
{% endblock %} {% block content %}
<section class="lista-carrito">
  {% if carrito %}
  <div class="items-carrito">
    {% for item in carrito %}
    <div class="item-carrito">
      <img
        src="{{ url_for('static', filename=item.imagen) }}"
        alt="{{ item.nombre }}"
      />
      <div class="detalle-producto">
        <div class="header-detalle">
          <h3 class="nombre-producto">{{ item.nombre }}</h3>
          <form
            method="POST"
            action="{{ url_for('main.quitar_del_carrito', producto_id=item.id) }}"
          >
            <button class="btn boton-quitar" type="submit">X</button>
          </form>
        </div>
        <div class="precio-quitar">
          <p class="precio">${{ item.precio }}</p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <div class="resumen-y-confirmacion">
    <div class="resumen-carrito">
      <div class="envio">
        <div class="cotizacion-wrapper">
          <p>Ingresá tu Código Postal para calcular el costo de envío:</p>
          <div class="cotizacion-horizontal">
            <input
              type="text"
              id="cp_destino"
              placeholder="Ej: 1704"
              value="8300"
              required
            />
            <button type="button" id="btn-cotizar-envio">Cotizar</button>
          </div>
        </div>

        <div class="tarjetas-envio">
          <label class="tarjeta-envio" for="envio-retiro-local" data-precio="0">
            <strong>Retiro en el local</strong><br />
            <span class="precio-opcion">$0.00 (sin costo)</span>
          </label>

          <label class="tarjeta-envio" for="envio-domicilio" data-precio="0">
            <strong>Envío a domicilio</strong><br />
            <span class="precio-opcion" id="precio-domicilio">--</span>
          </label>
        </div>
      </div>
      <div class="costos">
        <div>
          <span>Productos:</span><span id="subtotal">${{ subtotal }}</span>
        </div>
        <div><span>Envío:</span><span id="costo-envio">$0.00</span></div>
        <div>
          <span>Total:</span><span id="total-compra">${{ subtotal }}</span>
        </div>
      </div>
    </div>

    <div class="finalizar-compra-container">
      <button
        class="btn boton"
        id="btn-finalizar"
        data-bs-toggle="modal"
        data-bs-target="#modalCompra"
      >
        Continuar
      </button>
    </div>
  </div>

  <!-- Modal -->
  <div
    class="modal fade"
    id="modalCompra"
    tabindex="-1"
    aria-labelledby="modalCompraLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="form-datos-usuario">
          <div class="modal-header">
            <h5 class="modal-title" id="modalCompraLabel">
              Datos para la compra
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Cerrar"
            ></button>
          </div>
          <div class="modal-body">
            <!-- Datos personales -->
            <div class="mb-3">
              <label for="nombre" class="form-label">Nombre</label>
              <input
                type="text"
                class="form-control"
                id="nombre"
                name="nombre"
                required
              />
            </div>
            <div class="mb-3">
              <label for="apellido" class="form-label">Apellido</label>
              <input
                type="text"
                class="form-control"
                id="apellido"
                name="apellido"
                required
              />
            </div>
            <div class="mb-3">
              <label for="provincia" class="form-label">Provincia</label>
              <input
                type="text"
                class="form-control"
                id="provincia"
                name="provincia"
                required
              />
            </div>
            <div class="mb-3">
              <label for="localidad" class="form-label">Localidad</label>
              <input
                type="text"
                class="form-control"
                id="localidad"
                name="localidad"
                required
              />
            </div>
            <div class="mb-3">
              <label for="ciudad" class="form-label">Ciudad</label>
              <input
                type="text"
                class="form-control"
                id="ciudad"
                name="ciudad"
                required
              />
            </div>
            <div class="mb-3">
              <label for="cp_usuario" class="form-label">Código Postal</label>
              <input
                type="text"
                class="form-control"
                id="cp_usuario"
                name="cp_usuario"
                required
              />
            </div>
            <div class="mb-3" id="campo-direccion">
              <label for="direccion" class="form-label">Dirección</label>
              <input
                type="text"
                class="form-control"
                id="direccion"
                name="direccion"
              />
            </div>
            <div class="mb-3">
              <label for="referencias" class="form-label"
                >Piso / Departamento / Referencias</label
              >
              <input
                type="text"
                class="form-control"
                id="referencias"
                name="referencias"
              />
            </div>

            <!-- Tipo de envío -->
            <div class="mb-3" id="modal-tarjetas-envio">
              <label
                class="tarjeta-envio-modal"
                data-tipo="local"
                data-precio="0"
              >
                <input type="radio" name="tipo_envio" value="local" required />
                <strong>Retiro en el local</strong>
                <span class="precio-opcion-modal">$0.00 (sin costo)</span>
              </label>

              <label
                class="tarjeta-envio-modal"
                data-tipo="domicilio"
                data-precio="0"
              >
                <input
                  type="radio"
                  name="tipo_envio"
                  value="domicilio"
                  required
                />
                <strong>Envío a domicilio</strong>
                <span class="precio-opcion-modal" id="precio-domicilio-modal"
                  >--</span
                >
              </label>

              <label
                class="tarjeta-envio-modal"
                data-tipo="sucursal"
                data-precio="0"
              >
                <input
                  type="radio"
                  name="tipo_envio"
                  value="sucursal"
                  required
                />
                <strong>Retiro en sucursal</strong>
                <span class="precio-opcion-modal" id="precio-sucursal-modal"
                  >--</span
                >
              </label>
            </div>

            <!-- Selector de sucursal solo visible si se elige sucursal -->
            <div class="mb-3" id="campo-sucursal" style="display: none">
              <label for="selector-sucursal" class="form-label"
                >Seleccionar sucursal</label
              >
              <select id="selector-sucursal" class="form-control"></select>
              <small
                id="horarios-sucursal"
                class="form-text text-muted"
              ></small>
            </div>

            <!-- Contacto -->
            <div class="mb-3">
              <label for="email" class="form-label">Correo electrónico</label>
              <input
                type="email"
                class="form-control"
                id="email"
                name="email"
                required
              />
            </div>
            <div class="mb-3">
              <label for="telefono" class="form-label">Teléfono</label>
              <input
                type="tel"
                class="form-control"
                id="telefono"
                name="telefono"
                required
              />
            </div>
            <div class="mb-3">
              <label for="comentarios" class="form-label"
                >Comentarios adicionales</label
              >
              <textarea
                class="form-control"
                id="comentarios"
                name="comentarios"
                rows="3"
              ></textarea>
            </div>

            <!-- Términos -->
            <div class="mb-3 form-check">
              <input
                type="checkbox"
                class="form-check-input"
                id="acepto"
                required
              />
              <label class="form-check-label" for="acepto"
                >Acepto los términos y condiciones</label
              >
            </div>
          </div>
          <div class="modal-footer">
            <!-- Botón Guardar Pedido (provisional) -->
            <button type="button" class="btn boton" id="btn-guardar-pedido">
              Guardar Pedido
            </button>
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn boton" id="btn-pagar" disabled>
              Pagar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Habilitar botón Pagar solo si se selecciona un tipo de envío
    document.querySelectorAll('input[name="tipo_envio"]').forEach((radio) => {
      radio.addEventListener("change", () => {
        document.getElementById("btn-pagar").disabled = false;

        // Mostrar selector de sucursal solo si se eligió sucursal
        const campoSucursal = document.getElementById("campo-sucursal");
        campoSucursal.style.display =
          radio.value === "sucursal" ? "block" : "none";
      });
    });
  </script>

  {% else %}
  <p class="mensaje-vacio">Tu carrito está vacío</p>
  {% endif %}
  <script src="{{ url_for('static', filename='js/carrito.js') }}"></script>
</section>

{% endblock %}
